{
  "version": 3,
  "sources": ["../node_modules/@wxn0brp/event-emitter/dist/index.js", "../src/universal.ts", "../src/index.ts"],
  "sourcesContent": ["export class VEE {\n    _events = {};\n    /**\n     * Registers an event listener\n     * @param {K} event - event name\n     * @param {Function} listener - function to be called when event occurs\n     */\n    on(event, listener) {\n        const _event = event;\n        if (!this._events[_event])\n            this._events[_event] = [];\n        this._events[_event].push(listener);\n    }\n    /**\n     * Registers a one-time event listener\n     * @param {K} event - event name\n     * @param {Function} listener - function to be called once\n     */\n    once(event, listener) {\n        const onceListener = (...args) => {\n            this.off(event, onceListener);\n            listener(...args);\n        };\n        this.on(event, onceListener);\n    }\n    /**\n     * Removes an event listener.\n     * @param {K} event - event name\n     * @param {Function} listener - listener to remove\n     */\n    off(event, listener) {\n        const _event = event;\n        if (!this._events[_event])\n            return;\n        this._events[_event] = this._events[_event].filter(l => l !== listener);\n    }\n    /**\n     * Emits an event\n     * @param {K} event - event name\n     * @param {...EventArgs<T, K>} args - arguments to be passed to listeners\n     */\n    emit(event, ...args) {\n        const listeners = this._events[event];\n        if (listeners && listeners.length > 0) {\n            listeners.forEach(listener => {\n                listener(...args);\n            });\n        }\n    }\n    /**\n     * Returns the number of listeners for the given event\n     * @param {K} event - event name\n     */\n    listenerCount(event) {\n        return this._events[event]?.length || 0;\n    }\n}\nexport default VEE;\nexport { VEE as EventEmitter };\n", "let WebSocketImpl: any;\n\nif (typeof window === \"undefined\") {\n    const { WebSocket } = await import(\"ws\");\n    WebSocketImpl = WebSocket;\n} else {\n    WebSocketImpl = window.WebSocket;\n}\n\nexport default WebSocketImpl;", "import VEE, { EventArgs, EventMap, EventName } from \"@wxn0brp/event-emitter\";\nimport WebSocketImpl from \"./universal\";\n\nexport interface GLC_Opts {\n    reConnect: boolean,\n    reConnectInterval: number,\n    logs: boolean;\n    token: string;\n}\n\nexport interface GLC_DataEvent {\n    evt: string;\n    data: any[];\n    ackI?: number[];\n}\n\nexport interface GLC_AckEvent {\n    ack: number;\n    data: any[];\n}\n\nexport type InternalEvents = {\n    connect: (ws: WebSocket) => void;\n    error: (...err: any[]) => void;\n    disconnect: (ws: WebSocket, event: CloseEvent) => void;\n    unauthorized: (ws: WebSocket) => void;\n    forbidden: (ws: WebSocket) => void;\n    serverError: (ws: WebSocket) => void;\n}\n\nexport class GlovesLinkClient<InputEvents extends EventMap = {}, OutputEvents extends EventMap = {}> {\n    public ws: WebSocket;\n    public ackIdCounter: number;\n    public ackCallbacks: Map<number, Function>;\n    public handlers = new VEE<InputEvents>();\n    public opts: GLC_Opts;\n    public url: URL;\n\n    constructor(url: string, opts: Partial<GLC_Opts> = {}) {\n        this.ackIdCounter = 1;\n        this.ackCallbacks = new Map();\n        this.opts = {\n            logs: false,\n            reConnect: true,\n            reConnectInterval: 1000,\n            token: null,\n            ...opts\n        }\n\n        this.url = new URL(url, window ? window.location.href.replace(\"http\", \"ws\") : \"ws://localhost\");\n        if (this.opts.token) this.url.searchParams.set(\"token\", this.opts.token);\n\n        this._connect();\n    }\n\n    _connect() {\n        const id = Date.now().toString(36) + Math.random().toString(36).substring(2, 10);\n        this.url.searchParams.set(\"id\", id);\n        this.ws = new WebSocketImpl(this.url.href);\n\n        this.ws.onopen = () => {\n            if (this.opts.logs) console.log(\"[ws] Connected\");\n            // @ts-ignore\n            this.handlers.emit(\"connect\", this.ws);\n        }\n\n        this.ws.onerror = (...err: any) => {\n            if (this.opts.logs) console.warn(\"[ws] Error:\", err);\n            // @ts-ignore\n            this.handlers.emit(\"error\", ...err);\n        }\n\n        this.ws.onmessage = (_data) => {\n            const raw = _data?.data?.toString() || _data?.toString() || \"\";\n            let msg: GLC_DataEvent | GLC_AckEvent;\n\n            try {\n                msg = JSON.parse(raw);\n            } catch {\n                if (this.opts.logs) console.warn(\"[ws] Invalid JSON:\", raw);\n                return;\n            }\n\n            if (\"ack\" in msg) {\n                const ackId = msg.ack;\n                const ackCallback = this.ackCallbacks.get(ackId);\n                if (ackCallback) {\n                    this.ackCallbacks.delete(ackId);\n                    ackCallback(...msg.data);\n                }\n                return;\n            }\n\n            const { evt, data, ackI } = msg;\n            if (!evt || (data && !Array.isArray(data))) return;\n\n            if (Array.isArray(ackI)) {\n                for (let i = 0; i < ackI.length; i++) {\n                    const ackIndex = ackI[i];\n                    if (!data[ackIndex]) break;\n\n                    const ackId = data[ackIndex];\n                    data[ackIndex] = (...res: any) => {\n                        this.ws.send(JSON.stringify({\n                            ack: ackId,\n                            data: res\n                        }));\n                    };\n                }\n            }\n\n            // @ts-ignore\n            this.publicHandlers.emit(evt, ...data);\n        }\n\n        this.ws.onclose = (event: CloseEvent) => {\n            if (this.opts.logs) console.log(\"[ws] Disconnected\", event);\n            // @ts-ignore\n            this.handlers.emit(\"disconnect\", this.ws, event);\n\n            if (event.code === 1006) {\n                if (this.opts.logs) console.log(\"[ws] Connection closed by server\");\n                fetch(\"/gloves-link/status?id=\" + id).then(res => res.json()).then(data => {\n                    if (data.err) {\n                        if (this.opts.logs) console.log(\"[ws] Status error\", data.msg);\n                        return;\n                    }\n                    const status = data.status as number;\n                    if (this.opts.logs) console.log(\"[ws] Status\", status);\n                    // @ts-ignore\n                    if (status === 401) this.handlers.emit(\"unauthorized\", this.ws);\n                    // @ts-ignore\n                    else if (status === 403) this.handlers.emit(\"forbidden\", this.ws);\n                    // @ts-ignore\n                    else if (status === 500) this.handlers.emit(\"serverError\", this.ws);\n                })\n                return;\n            }\n            if (!this.opts.reConnect) return;\n\n            setTimeout(() => {\n                this._connect();\n            }, this.opts.reConnectInterval);\n        }\n    }\n\n    on<K extends EventName<InputEvents & InternalEvents>>(event: K, listener: (InputEvents & InternalEvents)[K]) {\n        this.handlers.on(event, listener as any);\n    }\n\n    once<K extends EventName<InputEvents & InternalEvents>>(event: K, listener: (InputEvents & InternalEvents)[K]) {\n        this.handlers.once(event, listener as any);\n    }\n\n    emit<K extends EventName<OutputEvents>>(evt: K, ...args: EventArgs<OutputEvents, K>) {\n        const ackI = args.map((data, i) => {\n            if (typeof data === \"function\") return i;\n        }).filter(i => i !== undefined);\n\n        for (let i = 0; i < ackI.length; i++) {\n            const ackIndex = ackI[i];\n            const ackId = this.ackIdCounter++;\n            this.ackCallbacks.set(ackId, args[ackIndex]);\n            args[ackIndex] = ackId;\n        }\n\n        this.ws.send(JSON.stringify({\n            evt,\n            data: args || undefined,\n            ackI: ackI.length ? ackI : undefined\n        }));\n    }\n\n    send<K extends EventName<OutputEvents>>(evt: K, ...args: EventArgs<OutputEvents, K>) {\n        return this.emit(evt, ...args);\n    }\n\n    close() {\n        this.ws.close();\n    }\n}\n\nexport {\n    GlovesLinkClient as default,\n    GlovesLinkClient as GLC,\n    GlovesLinkClient as client,\n}"],
  "mappings": "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",
  "names": ["VEE", "event", "listener", "_event", "onceListener", "args", "l", "listeners", "dist_default", "WebSocketImpl", "WebSocket", "universal_default", "GlovesLinkClient", "dist_default", "url", "opts", "id", "universal_default", "err", "_data", "raw", "msg", "ackId", "ackCallback", "evt", "data", "ackI", "i", "ackIndex", "res", "event", "status", "listener", "args"]
}
